@using System.Security.Claims
@using System.Net
@model VMStoryDetails
@{
    ViewData["Title"] = "StoryDeatils";
    var identity = User.Identity as ClaimsIdentity;
    var uid = identity?.FindFirst(ClaimTypes.Sid)?.Value;
}
<link rel="stylesheet" href="~/css/story_page.css">
<partial name="RecommendedStoryModel" />
<div class="container-lg container-fluid position-relative">
    @if (Model.story.UserId == Convert.ToInt64(uid))
    {
        <a class="edit-btn bg-ci-primary d-flex flex-nowrap z-3" onclick="location.href = '/Volunteer/Story/Editstory/@Model.story.StoryId'">
            <i class="bi bi-pencil-square text-white"></i>
            <span class="text-nowrap text-white ms-2">Edit Story</span>
        </a>
        <a class="delete-btn bg-ci-danger d-flex flex-nowrap z-3" onclick="deleteById(@Model.story.StoryId)">
            <i class="bi bi-trash text-white"></i>
            <span class="text-nowrap text-white ms-2">Delete Story</span>
        </a>
    }
    @*delete confirm modal*@
    <div class="modal fade" id="confirmModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <form asp-action="Deletestory" asp-controller="Story" asp-area="Volunteer">
                <div class="modal-content">
                    <div class="modal-body">
                        <input type="number" value="" id="DeleteId" name="id" hidden />
                        <span class="fs-4 text-ci-danger">
                            <i class="bi bi-info-circle text-ci-danger"></i>
                            Are You Sure!??
                        </span>
                    </div>
                    <div class="modal-footer p-0 py-2 justify-content-center">
                        <button type="submit" class="btn-ci-danger fs-7">
                            Delete
                        </button>
                        <button type="reset" class="btn-ci-secondary fs-7" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-12 p-0 position-relative story-media">
            <div id="carouselExampleIndicators" class="carousel h-80 slide carousel-fade" data-bs-ride="carousel">
                <div class="carousel-inner h-100">
                    @{
                        var Count1 = 0;
                    }
                    @foreach (var j in Model.storyMedia)
                    {
                        Count1 += 1;
                        <div class="carousel-item @(Count1 == 1 ? "active" : "") h-100">
                            <img src="~/images/storyimages/@j.MediaPath" class="img-story d-block w-100 h-100" alt="..." />
                        </div>
                    }
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
                <div class="carousel-indicators" style="margin-bottom: -70px;">
                    @{
                        var Count2 = 0;
                    }
                    @foreach (var j in Model.storyMedia)
                    {
                        Count2 += 1;
                        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="@(Count2-1)" class="active"
                            aria-current="true" aria-label="Slide @(Count2+1)" style="width: 100px; height: 50px;">
                            <img class="d-block w-100 h-100 img-fluid" src="~/images/storyimages/@j.MediaPath" />
                        </button>
                    }
                </div>
            </div>
        </div>


        @{
            var user = Model.users.Where(x => x.UserId == Model.story.UserId).FirstOrDefault();
        }
        <div class="col-lg-6 col-12 text-muted ps-md-5 py-3 py-md-0 mt-0 mt-md-5">
            <div class="d-flex justify-content-between align-items-end">
                <div class="d-flex flex-column">
                    <div class="story-user">
                        <img src="~/images/@user.Avatar" />
                    </div>
                    <div class="mt-2">
                        @user.FirstName @user.LastName
                    </div>
                </div>
                <div class="border px-3 py-1 rounded-pill text-muted d-flex align-items-center"><img src="~/images/eye_open.png" class="me-2" />@Model.story.Views Views </div>
            </div>
            <div class="mt-3">
                @user.WhyIVolunteer
            </div>
            <div class="my-3">
                @Model.story.ShortDescription
            </div>
            <div class="vol-buttons w-100 d-flex justify-content-between">
                <button class="send-story-id d-flex share-btn justify-content-center align-items-center btn-ci-secondary w-50 m-1 px-0 text-secondary" data-bs-toggle="modal" data-bs-target="#mailstorymodal" data-id="@Model.story.StoryId">
                    <img src="~/images/add1.png" alt="" class="me-1">
                    <span class="d-none d-sm-block d-md-none d-xl-block">
                        Recommend to a Co-Worker
                    </span>
                </button>
                <button class="btn-ci-primary d-inline-flex align-items-center justify-content-center w-50 m-1 px-0" onclick="location.href = '/Volunteer/Mission/Mission_volunteering/@Model.story.MissionId'">
                    Open Mission&nbsp;&nbsp;&nbsp;<img src="~/images/right-arrow.png" alt="">
                </button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h3>@Model.story.Title</h3>
            <hr />
            <div class="mt-3">
                @Html.Raw(WebUtility.HtmlDecode(Model.story.Description))
            </div>
        </div>
    </div>

</div>

<script>
    function deleteById(id) {
        $('#confirmModal').modal('show');
        $('#DeleteId').val(id);
    }
</script>