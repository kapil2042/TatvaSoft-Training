@{
    ViewData["Title"] = "Home Page";
}
@model VMMissions

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<script>
    id = 0;
    function myfilter(fpg,fid){
        var country = "";
        $("input[name='country']:checked").each(function () {
            country = $(this).val();
        });

        var cities = "";
        $("input[name='city']:checked").each(function () {
            cities += $(this).val() + ",";
        });

        var theme = "";
        $("input[name='theme']:checked").each(function () {
            theme += $(this).val() + ",";
        });

        var skill = "";
        $("input[name='skill']:checked").each(function () {
            skill += $(this).val() + ",";
        });



        if(fid!=0){
            id=fid;
        }


        var searchquery = $("input[name='search']").val();
        $.ajax({
            type: 'POST',
            url: "/Volunteer/Mission/FilterMissions",
            data: { 'pg': fpg, 'id': id,'search': searchquery, 'country': country, 'cities': cities, 'theme': theme, 'skill': skill },
            success: function (res) {
                $('.gridajax').html($($.parseHTML(res)).filter("#gridviewpartial")[0].innerHTML);
                $('.listajax').html($($.parseHTML(res)).filter("#listviewpartial")[0].innerHTML);
                $('#pagination').html($($.parseHTML(res)).filter("#paginationpartial")[0].innerHTML);
                $('#count').html($($.parseHTML(res)).filter("#countpartial")[0].innerHTML);
            },
            error: function (data) {
                toastr.error("Some error in filtermission", "Error Message", { timeOut: 5000, "positionClass": "toast-top-right", "closeButton": true, "progressBar": true });
            }
        });

    }


    $(document).ready(function(){
        myfilter(fpg = 1, fid = 0);
    })
</script>


<link rel="stylesheet" href="~/css/mission_page.css" asp-append-version="true" />

<partial name="filter" model="Model" />

<partial name="secondNav" model="Model" />

<partial name="RecommendedMissionModel" />



<div class="container-lg container-fluid py-3 d-flex flex-wrap">
    <div class="d-flex flex-wrap align-items-center" id="filterlistcity">
    </div>
    <div class="d-flex flex-wrap align-items-center" id="filterlist">
    </div>
    <a class="fs-7 text-muted d-none" onclick="ClearAllElement()" id="clearbtn">Clear All</a>
</div>
<div class="container-lg container-fluid">
    <div class="d-inline-flex align-items-center justify-content-between w-100">
        <div class="fs-2" id="count"></div>
        <div class="d-none d-sm-block">
            <select class="sort-by my-1 me-3" onchange="myfilter(fpg = 1, fid = this.value);">
                <option value="">Sort By</option>
                <option value="1">Newest First</option>
                <option value="2">Oldest First</option>
                <option value="3">Lowest Available Seats</option>
                <option value="4">Highest Available Seats</option>
                @if (User.Identity.IsAuthenticated)
                {
                    <option value="5">My Favourite Missions</option>
                }
                <option value="6">Registration Deadline</option>
            </select>
            <button class="p-2 border-0 bg-white rounded-circle grid-active" id="grid">
                <img src="~/images/grid.png" alt="">
            </button>
            <button class="p-2 border-0 bg-white rounded-circle" id="list">
                <img src="~/images/list.png" alt="">
            </button>
        </div>
    </div>
</div>


<div class="container-lg container-fluid">
    <div class="row gridajax" id="searchResults">
    </div>
    <div class="row listajax d-none" id="searchResults">
    </div>
</div>

<div id="pagination">
</div>